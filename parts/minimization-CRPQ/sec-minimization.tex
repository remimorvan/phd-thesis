%\diego{Intro atom minimisation/minimality leave variable minimiality defn for later. Better call them just ``minimal'' instead of ``atom-minimal''.}

Here we define the main problems that we will study, namely the "minimization problem" for "CRPQs" and for "UCRPQs".


\AP
\decisionproblem{""Minimization problem"" for "CRPQs"}
{A finite alphabet $\A$, a "Boolean"  "CRPQ" $\gamma$ over $\A$ and $k \in \N$.}
{Does there exist a "CRPQ" $\delta$ over $\A$ with at most $k$ "atoms"\\ 
such that $\gamma \semequiv \delta$?}

\decisionproblem{\reintro{Minimization problem} for "UCRPQs"}
{A finite alphabet $\A$, a "Boolean"  "UCRPQ" $\Gamma$ over $\A$ and $k \in \N$.}
{Does there exist a "UCRPQ" $\Delta$ over $\A$ whose every "CRPQ" has at most $k$ "atoms" 
such that $\Gamma \semequiv \Delta$?}

\remi{Is it clear that minimization of CRPQ in UCRPQ is the same as UCRPQ in UCRPQ?}

% \decisionproblem{""Atom-minimality problem""}
% {A finite alphabet $\A$ and "CRPQ" $\gamma$ over $\A$.}
% {Does every "CRPQ" $\delta$ over $\A$ such that $\gamma \semequiv \delta$\\
% have at least as many "atoms"  than $\gamma$?}

\AP
We say that a (U)CRPQ is ""minimal"" if it is not equivalent to any (U)CRPQ having less maximum number of atoms.

\paragraph{On the chosen size measure}
  We observe that, as is the case for any minimization task, we have an implicit measure of `size', which in our case we have taken to be the maximum size of number of atoms.
  Why this choice?
  A na√Øve algorithm for the "evaluation" of a union of $t$ "CRPQs" with $k$-atoms on a graph database $G$ gives a rough bound of $O\big(t  k  (|\edges{G}|  r)^2 + t  |\vertex{G}|^{2k}\big)$ on a database with $n$ facts, where $r$ is the maximum size of the regular languages it contains, and $\edges{G}$, $\vertex{G}$ are the set of edges and vertices of $G$, respectively.\footnote{This is obtained by first materializing a table with the answers to each RPQ atom $x \atom{e} y$ of the query by listing all pairs of reachable vertices of $G$ in the synchronous product $G \times A_e$ between the database and the NFA $A_e$ for the regular expression $e$ in $O((|G|r)^2)$ ---and there are $tk$-many atoms---, and then evaluating each "CRPQ" as if it were a "conjunctive query" on the computed tables (each table having size at most $|\vertex{G}|^2$), in $O((|\vertex{G}|^2)^k) = O(|\vertex{G}|^{2k})$.}
  As we see, the most costly dependence is of $k$, since $G$ is the largest object ("ie", the database, several orders of magnitude larger than the remaining parameters in practice). The size of regular expressions and the number of unions have a less predominant multiplicative influence on the cost.
  Further, unions can be executed in parallel, which justifies the choice of taking the maximum size of the number of atoms of the CRPQ therein.
  However, other measures may also be reasonable. For example, taking the size to be the number of variables instead of the number of atoms as explored in \Cref{sec:varmin}.
  More complex measures including the size of regular expressions and the number of unions would need to take into account the drastically different roles of the parameters in the evaluation in view of the previous discussion ("eg", a simple sum of the parameters would not be a reasonable choice).
  \miguel{Would be nice to add a motivation from practice. My feeling is that it is very common in practice to evaluate CRPQs using traditional techniques from relational databases, and hence, minimizing the number of joins (atoms) is crucial. Will look for references.}
  \diego{Agreed. Could you add sth in this direction?}



