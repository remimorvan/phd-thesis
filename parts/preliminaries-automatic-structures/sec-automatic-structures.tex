\section{Automatic Structures}
\label{sec:preliminaries-automatic-structures-automatic-structures}

todo:blabla

We fix a finite "relational signature" $\sigma$.
An \AP""automatic presentation $\+A$ of a $\sigma$-structure"" consists of:
\begin{itemize}
	\item an alphabet $\Sigma$,
	\itemAP a "regular language" $\intro*\domainPres{\+A} \subseteq \Sigma^*$,
	\itemAP for every relation $\+R_{(k)} \in \sigma$, an
		"automatic relation" $\intro*\relPres{\+R}{\+A} \subseteq (\Sigma^*)^k$, and
	\itemAP a binary "automatic relation" $\reintro*\relPres{=}{\+A} \subseteq
		\Sigma^* \times \Sigma^*$. 
\end{itemize} 
The \AP""structure represented"" $\?A$ by ""an automatic presentation"" $\+A$ has
$\domainPres{\+A}/{\relPres{=}{\+A}}$ as its domain, and the predicate $\+R_{(k)} \in \sigma$
is "interpreted@@pred" in such a way that a tuple $\tup{X_1,\hdots,X_k}$ of equivalence classes
belongs to $\+R(\?A)$ if, and only if, there exists $\tup{u_i}_{1 \leq i \leq k} \in\tup{X_i}_{1 \leq i \leq k}$ "st" $\tup{u_1,\hdots,u_k} \in \relPres{\+R}{\+A}$.
We say that a "$\sigma$-structure" is ""automatic@@struct"" if it is
"represented@@struct" by ""an automatic presentation"".%
\footnote{Note that we can always assume "wlog" that $\relPres{\+R}{\+A} \subseteq
(\domainPres{\+A})^k$ since $(\domainPres{\+A})^k$ is "automatic@@rel" by
\Cref{prop:rec-implies-aut} and "automatic relations" are closed under intersection.}

For instance, the infinite binary tree admits can be represented by the "automatic presentation"
$\+B$ with $\domainPres{\+B} = \2^*$,
\[
	\relPres{\+E}{\+B} =
	\{\tup{u,u0} \mid u \in \2^*\} \cup \{\tup{u,u1} \mid u \in \2^*\},
\]
and $\relPres{=}{\+B}$ is equality.
todo: figure.
Presentations such as this one, where $\relPres{=}{\+B}$ is the equality relation,
are called ""injective presentations"".

\begin{example}
	The structure $\tup{\N, +}$ is "automatic".%
	\footnote{We see $+$ as a ternary relation, given by $\{\tup{x,y,x+y} \mid x, y \in \N^2\}$.}
	We build an "automatic presentation" $\+N$ by using
	a binary encoding $\domainPres{\+N} = \2^*$. A word $w \in \2^*$ will
	represent the number $\sum_{i=1}^{|w|} w_i\cdot 2^{i-1}$. 
	Naturally, it follows that $\relPres{=}{\+N}$ puts two words $u$ and $v$ in relation
	if they are equal after removing the trailing zeroes.
	We then need to describe $\relPres{+}{\+N}$: the idea is to simulate addition, reading words
	from left to right, by using two states ($0$ and $1$) to remember the carry.
	\begin{marginfigure}
		\centering
		\begin{tikzpicture}[shorten >= 1pt, node distance = 1.8cm, on grid, baseline]
			\node[state, initial left, accepting] (q0) {}; 
			\node[state, right=of q0] (q1) {}; 
			\path[->]
				(q0) edge[loop above] node[font=\scriptsize, above left = 0em and -1.1em] {$\triple{0}{0}{0},
					\triple{0}{1}{1},\triple{1}{0}{1}$} (q0)
				(q0) edge[bend left] node[font=\scriptsize, above] {$\triple{1}{1}{0}$} (q1)
				(q1) edge[loop below] node[font=\scriptsize, below right = 0em and -1.1em] {$\triple{0}{1}{0},\triple{1}{0}{0},\triple{1}{1}{1}$} (q1)
				(q1) edge[bend left] node[font=\scriptsize, below] {$\triple{0}{0}{1}$} (q0);
		\end{tikzpicture}
		\caption{
			\AP\label{fig:automaton-presburger}
			"Synchronous automaton" describing the addition of
			natural numbers. For the sake of readability, transitions involving
			the "padding symbol" are not represented: $\pad$ is treated as a zero.
		}
	\end{marginfigure}
	For instance, the transition
	$\textcolor{c0}{0}
	\transition{\tup{\textcolor{c1}{0},\textcolor{c1}{1},\textcolor{c3}{1}}}
	\textcolor{c2}{0}$ can be understood as
	``when adding $\textcolor{c1}{0}$ and $\textcolor{c1}{1}$, with current carry $\textcolor{c0}{0}$, the results equals $\textcolor{c3}{1}$, with a carry of $\textcolor{c2}{0}$ for the next bit''.
	In general, we have a transition
	\[
		\textcolor{c0}{p}
		\transition{\tup{\textcolor{c1}{x},\textcolor{c1}{y},\textcolor{c3}{z}}}
		\textcolor{c2}{q}
		\quad\text{"iff"}\quad
		\textcolor{c1}{x} + \textcolor{c1}{y} + \textcolor{c0}{p}
		= \textcolor{c3}{z} + 2\textcolor{c2}{q}
	\]
	for all $p,q \in \2$ and
	$\tup{x,y,z} \in \2 \convolAlpha \2 \convolAlpha \2$.%
	\footnote{Of course, we identify $\pad$ with $0$.}
	This gives the automaton of figure \Cref{fig:automaton-presburger}.
	By construction, $\+N$ "represents@@struct" $\tup{\N, +}$.
\end{example}

Recall that, using \Cref{prop:automatic-first-order}, a "relation" is "automatic@@rel" 
if and only if they are "first-order definable" over $\signatureSynchronous{\Sigma}$.
It means that we can alternatively see "automatic presentations" as a
collection of first-order formulas---one for the domain, one for equality, and
one for each predicate. In turns, this view helps us prove the following result.
For instance, $\langle \univStructSynchronous{\Sigma}, \langle\lastLetter{a}\rangle_{a \in \Sigma},\, \equalLength,\, \prefix \rangle$ is an "automatic structure".


\begin{proposition}
	\AP\label{prop:making-presentations-injective}
	Any "automatic structures" admits an "injective presentation".
\end{proposition}

\begin{proof}
	We prove this property using logic. Let $\+A$ be an arbitrary "automatic presentation"
	that "represents@@struct" $\?A$. The idea to build an "injective automatic presentation" $\+A'$
	of $\?A$ is to represent an equivalence class $\equivclass[\relPres{=}{\+A}]{u} \subseteq
	\domainPres{\+A}$ by its "lexicographic"-minimal element.%
	\footnote{This makes sense as the "lexicographic order" is a well-founded total order.}

	Concretely, $\+A'$ has the same alphabet as $\+A$.
	Then, we define $\domainPres{\+A'}$ as the set of lexicographic-minimal elements of
	$\equivclass[\relPres{=}{\+A}]{u}$ ($u \in \domainPres{\+A}$),
	which can be described by the "first-order formula"%
	\footnote{For the sake of readability, we identify first-order formulas with the relations they define.}
	\[
		\domainPres{\+A'}(x) \defeq
		\forall y.\; (\domainPres{\+A}(y) \land x \mathrel{\relPres{=}{\+A}} y) \Rightarrow 
		x \lex y.
	\]
	In is indeed a "first-order formula" since $\+A$ is assumed to be "automatic@@pres",
	and since $\lex$ is "automatic@@rel" by \Cref{ex:lexicographic-is-automatic}.
	Equality is interpreted as proper equality,
	and then
	\[
		\relPres{\+R}{\+A'}(x_1,\hdots, x_k) \defeq
		\exists y_1.\,\hdots \exists y_k.\,
		\Big( \bigwedge_{i=1}^k x_i \mathrel{\relPres{=}{\+A}} y_i \Big)
		\land \relPres{\+R}{\+A}(y_1,\hdots, y_k),
	\]
	for any predicate $\+R_{(k)} \in \sigma$.
	Overall, $\+A'$ is an "injective presentation" that "represents@@struct" 
	exactly the same "structure" as $\+A$.
\end{proof}

\begin{proposition}
	\AP\label{prop:making-presentations-binary}
	Any "automatic structures" admits a "presentation" with an alphabet of size 2.
\end{proposition}

\begin{proof}
	The idea is to encode each letter of $\Sigma = \{a_1,\hdots,a_n\}$
	over $\2$ in such a way that each letter $a_i$
	is encoded over a word $\hat a_i \in \2^*$ "st"
	all $\hat a_i$ have the same length---this is necessary to preserve "automaticity".
	For instance, take $\hat a_i$ to be the binary encoding of $i$
	over $k$ bits, for some fixed value of $k \gtrsim \log_2(n)$.
	Then, by \Cref{prop:automatic-closure-length-multiplying-morphism},
	the relations we obtain are still "automatic@@rel".
\end{proof}

Putting \Cref{prop:making-presentations-injective,prop:making-presentations-binary}
together, we get the following result, that says that $\univStructSynchronous{2}$ is ``universal'',
in the sense that it is not only automatic, but it ``contains'' all "automatic structures".
\begin{proposition}
	\AP\label{prop:universal-automatic-structure}
	Let $\?A$ be a $\sigma$-structure. The following are equivalent:
	\begin{enumerate}
		\itemAP\label{item:universal-automatic-structure-auto}
			$\?A$ is "automatic@@struct",
		\itemAP\label{item:universal-automatic-structure-injective-FO}
			$\?A$ is an injective one-dimensional "first-order interpretation" of
			$\univStructSynchronous{2}$,
		\itemAP\label{item:universal-automatic-structure-FO}
			$\?A$ is a "first-order interpretation" of $\univStructSynchronous{2}$.
	\end{enumerate}
\end{proposition}

Recall that $\univStructSynchronous{2}$ is the structure $\2^*$ equipped
with $\lastLetter{0}$, $\lastLetter{1}$, $\equalLength$ and $\prefix$: it can be
seen as the infinite binary tree, with unary relation saying if a node is a
left or right child, and two binary relations saying if two nodes are
at the same depth, and if one is an ancestor of the other.

\begin{proof}
	% \eqref{item:universal-automatic-structure-FO} $\Rightarrow$
	% \eqref{item:universal-automatic-structure-injective-FO} and
	% \eqref{item:universal-automatic-structure-injective-FO} $\Rightarrow$
	% \eqref{item:universal-automatic-structure-auto} are trivial.
	\eqref{item:universal-automatic-structure-auto} $\Rightarrow$
	\eqref{item:universal-automatic-structure-injective-FO} follows from
	\Cref{prop:making-presentations-injective,prop:making-presentations-binary}.
	\eqref{item:universal-automatic-structure-injective-FO} $\Rightarrow$
	\eqref{item:universal-automatic-structure-FO} is trivial.
	\eqref{item:universal-automatic-structure-FO} $\Rightarrow$
	\eqref{item:universal-automatic-structure-auto} can be proven by,
	given a "$k$-dimensional interpretation", defining an "automatic presentation"
	over the alphabet
	\[
		\underbrace{\2 \convolAlpha \cdots \convolAlpha \2}_{
			\text{$k$ times}
		},
	\]
	and changing any "first-order formula"
	\[
		\phi\big((x_1^1, \hdots, x_1^k), \hdots, (x_n^1, \hdots, x_n^k)\big)
		\quad\text{into}\quad
		\phi^*(x_1^1 \convol \cdots \convol x_1^k, \hdots, x_n^1 \convol \cdots \convol x_n^k).\qedhere
	\]
\end{proof}

In the statement of \label{prop:universal-automatic-structure} the
$\univStructSynchronous{2}$ can be replaced by any "automatic structure" $\?U$
"st" there is an injective one-dimensional "first-order interpretation" of
$\univStructSynchronous{2}$ in $\?U$. 
Another example of ``universal'' structure consists of the finite subsets of $\N$ equipped
with inclusion and the preorder $\preceq$ defined by $X \preceq Y$ "iff" $X$ and $Y$ are 
singletons, say $\{x\}$ and $\{y\}$, respectively, and $x \leq y$,
see \cite[Theorem~XII.2.3]{Blumensath2024MSOModelTheory}.


\begin{itemize}
	\itemAP ""automatic graph""
	\item see https://www.logic.rwth-aachen.de/pub/graedel/lics2020.pdf
	\item \cite[\S~6]{KhoussainovNerode1995AutomaticPresentations}
	\item no infinite integral domain \cite{KhoussainovNiesRubinStephan2007Automatic}
	\item Olivier Finkel's papers
\end{itemize}

TODO:generalized presentation (non-injective) + effective construction to make them injective.
-> this explains our choice. We avoid the terminology ``regular structure'' because of
``regular graph''.
