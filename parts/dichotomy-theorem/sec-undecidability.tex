\section{\AP\label{sec:undecidability}%
	Undecidability of the Homomorphism Problems}


We prove the undecidability of $\HomAut{\?B}$ and $\HomRegFin{\?B}$
when $\?B$ does not have "finite duality". Both reductions are
direct adaptations of the proof that $\HomFin{\?B}$ is "L"-hard when $\?B$ does not
have finite duality by \textcite[Theorem 3.2]{LaroseTesson2009UniversalAlgebraCSP}.
However, proving the undecidability of the problem that is reduced
to $\HomRegFin{\?B}$ is not entirely trivial and requires some work.

\subsection{\AP\label{sec:undecidability-hom}%
	Undecidability of \,$\HomAut{\?B}$}

For $n\in\N$, we define the \AP""$n$-link"" $\intro*\link{n}$ be the "$\sigma$-structure"\sidenote{From \cite[\S~2]{LaroseLotenTardif2007CharacterisationFOCSP}.} 
whose domain is $\lBrack 0,n\rBrack$, and every "relation symbol" $\+R$
of arity $k$, is interpreted as the set of tuples $\langle a_1,\, \hdots,\, a_k \rangle$
"st" $|a_i-a_j| \leq 1$ for all $i,j \in \lBrack 0,n \rBrack$.\sidenote{Todo: add figure for digraphs.}
Given a "$\sigma$-structure" $\?B$, say that $b \in \?B$ and $b'$ are
\AP""$n$-linked"" if there exists a "homomorphism" from $\link{n}$ to $\?B$
that sends $0$ to $b$ and $n$ to $b'$. We say that $b$ and $b'$ are \AP""linked"" if
they are "$n$-linked" for some $n \in \N$.

Note that the fact that $k \mapsto n-k$
defines an "automorphism" of $\link{n}$ implies that the relation of being "$n$-linked"---
and to a greater extent of being "linked"---is symmetric.
Moreover, being "linked" is transitive, but not necessarily reflexive.

% \begin{fact}[Link Composition]
% 	\AP\label{fact:link-composition}
% 	Let $n,m \in \N$, let $\?B$ be a "$\sigma$-structure", and let $b,b',b'' \in B$.
% 	If $b$ and $b'$ are "$n$-linked" and $b'$ and $b''$ are "$m$-linked", then
% 	$b$ and $b''$ are "$(n+m)$-linked".
% \end{fact}
% We define the binary relation $\sim_n$
% on $\link{n} \prodstruct \iterstruct{\?B}{2}$ as follows:\sidenote{From \cite[\S~4.3]{LaroseLotenTardif2007CharacterisationFOCSP}.}%
% \[
% 	\langle k,\, b_1,\, b_2\rangle \sim_n \langle k',\, b'_1,\, b'_2\rangle
% 	\quad\text{when}\quad
% 	\begin{cases*}
% 		\;\langle k,\,  b_1,\, b_2\rangle = \langle k',\, b'_1,\, b'_2\rangle\text{, or}\\
% 		\;k = k' = 0 \text{ and } b_1 = b'_1\text{, or}\\
% 		\;k = k' = n \text{ and } b_2 = b'_2.
% 	\end{cases*}
% \]

\begin{proposition}[{\cite[Theorem 4.7]{LaroseLotenTardif2007CharacterisationFOCSP}}]%
	\!\footnote{Actually \cite[Theorem 4.7]{LaroseLotenTardif2007CharacterisationFOCSP} assumes
	that $\HomFin{\?B}$ is "first-order definable", but this condition
	is equivalent to $\?B$ having "finite duality" by Atserias' result
	\cite[Corollary 4]{Atserias2008DigraphColoring}.}%
	%%%
	\AP\label{prop:characterization-finite-duality-path-projections}
	A finite "$\sigma$-structure" $\?B$ has "finite duality" "iff"
	$\projHom{1}$ and $\projHom{2}$ are "linked" in $\powstruct{\?B}{(\iterstruct{\?B}{2})}$.
\end{proposition}

Equipped with the previous proposition, we can now show the undecidability 
of $\HomAut{\?B}$ by reduction from the following problem.

\decisionproblem{""Connectivity in Automatic Graphs""}{
	An "automatic presentation of a directed graph" $\•G$,
	and two elements $s,t \in \Sigma^*$.
}{
	Are $\•G(s)$ and $\•G(t)$ "connected" in $\?G$?
}
\begin{property}
	\AP\label{prop:undecidability-connectivity}
	For any "signature" $\sigma$ containing at least one "relation symbol" of
	arity at least 2, "Connectivity in Automatic Graphs" is "RE"-complete.
\end{property}

\begin{proof}
	This follows from the fact that the "configuration graph" of
	a "Turing machine" is always "automatic" by TODO:addref.
	TOdo:Give more precisions.
\end{proof}

\begin{lemma}
	\AP\label{lem:reduction-hom}
	Assume that $\sigma$ contains at least one "relation symbol" of arity at least 2.
	If $\?B$ does not have "finite duality", then there is a TODO:complexity reduction 
	from the complement of "Connectivity in Automatic Graphs" to $\HomAut{\marked{\?B}}$.
\end{lemma}

\begin{proof}
	\marginnote{TODO:Addfigure}%
	Given an instance $\langle \•G, s, t \rangle$ of "Connectivity in Automatic Graphs",
	we first define the $\sigma$-structure $\?A$ with "automatic presentation" $\•A$
	obtained by replacing every edge by a "$1$-link".
	Formally, $\?A$ has the same domain as $\?G$, and for any
	"relation symbol" $\+R \in \sigma$ of arity $k$,
	$\langle g_1,\, \hdots,\, g_k \rangle \in \+R(\?A)$ "iff"
	$\{g_1, \hdots, g_k\} = \{g,g'\}$ for some $g,g' \in G$ "st"
	there is an edge from $g$ to $g'$ in $\?G$.

	\begin{claim}
		\AP\label{claim:reduction-hom-from-graph-to-link}
		$\•G(s)$ and $\•G(t)$ are "connected" "iff"
		$\•A(s)$ and $\•A(t)$ are "linked".
	\end{claim}
	For the left-to-right implication: if there is an edge between two elements
	in $\?G$, then they are "$1$-linked" in $\?A$. Since being "linked" is
	reflexive and transitive, the conclusion follows.
	Conversely, if two elements $a$ and $a'$ of $\?A$ are "$1$-linked", 
	then pick a "relation symbol" $\+R \in \sigma$ of arity at least 2.
	Then $\langle a,\, \hdots,\, a,\, a' \rangle \in \+R(\?A)$,
	and so by definition of $\?A$ there is either an edge from $a$ to $a'$
	or from $a'$ to $a$ in $\?G$.\sidenote{Note that the proof of this claim
	is the only part of the proof of \Cref{lem:reduction-hom} that requires
	the assumption that $\sigma$ contains at least one "relation symbol" of arity at least 2.}

	We then consider the "automatic $\sigma$-structure" $\?A\prodstruct \iterstruct{\?B}{2}$---see
	\Cref{sec:construction-automatic-presentations} to have an explicit construction of an "automatic presentation" for this structure---, and extend it to a
	"$\extendedSignature{\sigma}{\?B}$-structure" \AP\(\intro*\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})}\)
	in which for each $b_0 \in B$,
	we "interpret" the unary predicate $\unarypred{b_0}$ as
	\[
		\big\{\;
			\langle a,\, b,\, b'\rangle \;\big\vert\;
			a = \•A(s) \text{ and } b = b_0 \text{, or }
			a = \•A(t) \text{ and } b' = b_0
		\;\big\}.
	\]
	To construct an "automatic presentation" for this structure, see \Cref{sec:construction-automatic-presentations}.
	\begin{claim}
		\AP\label{claim:reduction-hom-direct}
		If $\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \homto \marked{\?B}$,
		then $\•G(s)$ and $\•G(t)$ are not "connected" in $\?G$.
	\end{claim}
	Let $f\colon \ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \homto \marked{\?B}$
	be a "homomorphism".\sidenote{Recall that both sides are
	"$\extendedSignature{\sigma}{\?B}$-structures".}
	It induces a "homomorphism"
	\[
		\overbar f\colon \ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \homto \?B
	\]
	between "$\sigma$-structures", and by currying (\Cref{prop:currying-hom}),
	$\overbar f$ can be seen as a "homomorphism"
	\[
		\widehat f\colon \?A \homto \powstruct{\?B}{(\iterstruct{\?B}{2})}.
	\]
	Note moreover that because $\overbar f$ comes from a "homomorphism" between
	$\extendedSignature{\sigma}{\?B}$ then we must have  
	any triplet $f(\•A(s),\, b,\, b') = b$
	and $f(\•A(t),\, b,\, b') = b'$ for all $b,b' \in B$.
	This implies that $\widehat f(\•A(s)) = \projHom{1}$ and $\widehat f(\•A(t)) = \projHom{2}$.
	
	We now assume by contradiction that there is some $n \in \N$
	"st" there is a "homomorphism" $g\colon \link{n} \to \?A$
	with $g(0) = \•A(s)$ and $g(n) = \•A(t)$.
	Then by composition, we obtain a "homomorphism"
	\[
		\widehat f \circ g\colon
		\link{n} \to \powstruct{\?B}{(\iterstruct{\?B}{2})},
 	\]	
	which sends $0$ to $\widehat f(g(0)) = \widehat f(\•A(s)) = \projHom{1}$
	and sends $n$ to $\widehat f(g(n)) = \widehat f(\•A(t)) = \projHom{2}$.
	So, by \Cref{prop:characterization-finite-duality-path-projections},
	$\?B$ would have "finite duality", which is a contradiction.
	Hence, $\•A(s)$ and $\•A(t)$ are not "linked",
	and so by \Cref{claim:reduction-hom-from-graph-to-link}, $\•G(s)$ and $\•G(t)$
	are not "connected".

	\begin{claim}
		\AP\label{claim:reduction-hom-converse}
		If $\•G(s)$ and $\•G(t)$ are not "connected" in $\?G$,
		then $\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \homto \marked{\?B}$.
	\end{claim}
	We define a homomorphism $f\colon \ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \to \marked{\?B}$ by:
	\[
		f(a, b, b') \defeq \begin{cases*}
			\;b & \text{ if $\•A(s)$ and $a$ are "linked",} \\
			\;b' & \text{ otherwise.}
		\end{cases*}
	\]
	We show that this is indeed a "homomorphism": for any "relational symbol" $\+R$
	of arity $k$ in $\sigma$, if
	\[
		\langle a_1,\, b_1,\, b'_1 \rangle,\;
		\langle a_2,\, b_2,\, b'_2 \rangle,\;
		\hdots,\;
		\langle a_k,\, b_k,\, b'_k \rangle
	\]
	are all "$\+R$-hyperedges" of $\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})}$,
	then by definition of $\?A$, we have that either (1) all $a_i$'s are equal,
	or (2) $\{a_1,\, \hdots,\, a_k\} = {a,a'}$ for some $a \neq a' \in A$
	and there is an edge from $a$ to $a'$ or from $a'$ to $a$ in $\?G$.
	In both cases, it follows that $\•A(s)$ and $a_i$ are "linked"
	"iff" $\•A(s)$ and $a_j$ for all $i,j\in \lBrack 1,k\rBrack$.
	Hence, either $f(a_i,\, b_i,\, b'_i) = b_i$ for all $i\in \lBrack 1,k\rBrack$,
	or $f(a_i,\, b_i,\, b'_i) = b'_i$ for all $i\in \lBrack 1,k\rBrack$.
	In both cases, we get that
	\[
		\Big\langle
			f(a_1,\, b_1,\, b'_1),\;
			f(a_2,\, b_2,\, b'_2),\;
			\hdots,\;
			f(a_k,\, b_k,\, b'_k)
		\Big\rangle
		\in \+R(\?B).
	\]
	We also need to show that this map preserves the new unary predicates of
	$\extendedSignature{\sigma}{\?B}$: this follows from---and is in fact equivalent to---the
	fact that $\•A(s)$ and $\•A(t)$ are not "linked" by \Cref{claim:reduction-hom-from-graph-to-link}.
	Overall, this proves that $\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})} \homto \marked{\?B}$.

	Putting \Cref{claim:reduction-hom-direct,claim:reduction-hom-converse} together,
	we get that the reduction is correct.
	Lastly, note that is works in TODO:complexity because TODO.
\end{proof}

By \Cref{prop:undecidability-connectivity}, the complement of "Connectivity in Automatic Graphs"
is "coRE"-complete, and assuming that $\sigma$ contains at least one "relation symbol" of "arity" 2,
it reduces by \Cref{lem:reduction-hom} to any problem $\HomAut{\marked{\?B}}$ when $\?B$ has "finite duality". In turns, by \Cref{prop:marking-preserves-csp-complexity}, it reduces to
$\HomAut{\?B}$, which is thus "coRE"-hard. It remains to deal with "signatures" consisting of only
"unary predicates".\sidenote{It is not clear to us whether this case was properly handled in
\cite{LaroseLotenTardif2007CharacterisationFOCSP}.}

\begin{property}
	\AP\label{prop:finite-duality-unary-predicates}
	If $\sigma$ only consists of unary predicates, then all $\sigma$-structures
	have "finite duality".
\end{property}	

\begin{proof}
	Fix a $\sigma$-structure $\?B$. We define the \AP""unary type@@elem""
	$\intro*\unaryType{b}{\?B}$ of $b \in \?B$
	to be the set of "relation symbols" $\+P$ "st" $b \in \+P(\?B)$.
	
	Given $\tau \subseteq \sigma$, define \AP$\intro*\structOfUnaryType{\tau}$
	to be the "$\sigma$-structure"
	consisting of a single element $*$, and "st" $* \in \+P(\?1_\tau)$ "iff"
	$\+P \in \tau$.
	We say that $\tau$ is \AP""obstructing@@unarytype"" if
	$\tau \not\subseteq \unaryType{b}{\?B}$ for all $b \in \?B$.

	\begin{claim}
		\AP\label{claim:finite-duality-unary-predicates-direct}
		If $\tau$ is "obstructing@@unarytype",
		then $\structOfUnaryType{\tau} \nothomto \?B$.
	\end{claim}
	We prove the result by contraposition.
	Any "homomorphism" from $\structOfUnaryType{\tau}$ to $\?B$
	should send $*$ on some element $b$ of $\?B$
	"st" $b \in \+P(\?B)$ for all $\+P \in \tau$, and
	hence $\tau \subseteq \unaryType{b}{\?B}$.

	\begin{claim}
		\AP\label{claim:finite-duality-unary-predicates-converse}
		If $\?A \nothomto \?B$ then there exists an "obstructing@@unarytype"
		$\tau \subseteq \sigma$ "st" $\structOfUnaryType{\tau} \homto \?A$.
	\end{claim}
	We define a partial homomorphism $f$ from $A$ to $B$,
	by sending $a \in A$ to any $b \in B$ "st" the "unary type" of $a$
	is included in the "unary type" of $b$. This is clearly a (partial) "homomorphism",
	and so since $\?A \nothomto \?B$, it follows that it must be partial,
	"ie" that some element $a \in \?A$ "st" $\unaryType{a}{\?A} \not\subseteq
	\unaryType{b}{\?B}$ for any $b \in B$. It follows that $\unaryType{a}{\?A}$
	is "obstructing@@unarytype". Since $\structOfUnaryType{\unaryType{a}{\?A}} \homto \?A$
	"via" $* \mapsto a$, the conclusion follows.

	Putting \Cref{claim:finite-duality-unary-predicates-direct,claim:finite-duality-unary-predicates-converse} together, we get that
	\[
		\big\{\;
			\structOfUnaryType{\tau}
			\;\big\vert\;
			\text{ $\tau \subseteq \sigma$ is "obstructing@@unarytype"} 
		\;\big\}
	\]
	is a finite "complete set of obstructions" for $\?B$.
\end{proof}

\begin{corollary}
	\!\sidenote[][-15em]{In the case of Larose and Tesson, they study the problem
	$\HomFin{-}$, and prove in \cite[Theorem 3.2]{LaroseTesson2009UniversalAlgebraCSP}
	that there is a "first-order reduction" from "Connectivity in Finite Graphs" to
	$\HomFin{\marked{\?B}}$ assuming that $\?B$ does not have finite duality.
	Moreover, "Connectivity in Finite Graphs" is "L"-hard under "first-order reductions" since
	Etessami \cite[Theorem 3.2]{Etessami1997CountingLogSpace} proved that the problem
	of given a directed path and two vertices $s$, $t$ to decide if there is a path from
	$s$ to $t$ is "L"-hard under "first-order reductions"-in fact even under quantifier-free reductions. It turn, this problem can be reduced in "first-order@@reduction"
	to "Connectivity in Finite Graphs" \cite{SamiD2015USTCONNLogspace}.
	Overall, and together with \Cref{prop:marking-preserves-csp-complexity},
	this shows that $\HomFin{\?B}$ is "L"-hard under "first-order reductions".}%
	%%%
	\AP\label{coro:lowerbound-hom}
	If $\?B$ does not have "finite duality", then $\HomAut{\?B}$
	is "coRE"-hard.
\end{corollary}

\begin{proof}
	By \Cref{prop:finite-duality-unary-predicates}, since $\?B$ does not have "finite duality",
	then $\sigma$ has at least one "relation symbol" of arity at least 2.
	The conclusion follows from \Cref{prop:marking-preserves-csp-complexity,prop:undecidability-connectivity,lem:reduction-hom}.
\end{proof}

\subsection{\AP\label{sec:undecidability-homreg}%
	Undecidability of \,$\HomRegAut{\?B}$}

The reduction to show undecidability of is nearly identical to \Cref{lem:reduction-hom},
but the input problem differs quite a lot.
\decisionproblem{""Regular Unconnectivity in Automatic Graphs""}{
	An "automatic presentation" $\•G$ of a "directed graph" $\?G$,
	and two elements $s,t \in \Sigma^*$.
}{
	Is there a regular language $L \subseteq \Sigma^*$ 
	such that $s \in L$, $t\not\in L$ and $L$ is a union of "connected components"
	of $\+G$?\footnotemark{}
	In this case we say that $s$ and $t$ are \AP""regularly unconnected"".
}
\footnotetext{Formally, we mean that $L = \•G^{-1}[U]$ for some union $U$ of "connected components" of $\?G$.}

We will first reduce this problem to $\HomRegAut{\?B}$, and will later settle its complexity.

\begin{lemma}
	\AP\label{lem:reduction-hom-reg}
	Assume that $\sigma$ contains at least one "relation symbol" of arity at least 2.
	If $\?B$ does not have "finite duality", then there is a TODO:complexity reduction 
	from the complement of "Regular Unconnectivity in Automatic Graphs"
	to $\HomRegAut{\marked{\?B}}$.
\end{lemma}

\begin{proof}
	Given an instance $\langle \•G, s, t \rangle$ of "Regular Unconnectivity in Automatic Graphs",
	we first define the $\sigma$-structure $\?A$ with "automatic presentation" $\•A$
	obtained by replacing every edge by a "$1$-link", as in \Cref{lem:reduction-hom}.

	\begin{claim}
		\!\footnote{While ``being "linked"'' is not reflexive in general, it is over the
		structure $\?A$, by reflexivity of ``being "connected"'' in $\•G$.}%
		\AP\label{claim:reduction-homreg-from-graph-to-link}
		$\•G(s)$ and $\•G(t)$ are "regularly unconnected" "iff"
		there is no $L \subseteq \Sigma^*$ "st" $\•A(s)\in L$ and $t \not\in L$,
		and $L$ is a union of equivalences classes of $\domainPres{\•A}$
		under ``being "linked"''.
	\end{claim}
	The proof is similar to \Cref{claim:reduction-homreg-from-graph-to-link}.
	Then again, we reduce the instance $\langle \•G, s, t \rangle$
	to an "automatic presentation" of \(\ConstrUndecHom{(\?A\prodstruct \iterstruct{\?B}{2})}\),
	as in \Cref{lem:reduction-hom}.
	\begin{claim}
		\AP\label{claim:reduction-homreg-direct}
		If $\ConstrUndecHom{(\•A\prodpres \iterstruct{\?B}{2})} \homregto \marked{\?B}$,
		then $\•G(s)$ and $\•G(t)$ are "regularly unconnected" in $\?G$.
	\end{claim}
	
	Let \(f\colon \ConstrUndecHom{(\•A\prodpres \iterstruct{\?B}{2})} \to \marked{\?B}\)
	be a "regular homomorphism".
	By currying---see \Cref{coro:homreg-currying}---of the underlying "homomorphism"
	between "\(\sigma\)-structures", we obtain a "regular homomorphism"
	\[
		\widehat f\colon \•A \homto \powstruct{\?B}{(\iterstruct{\?B}{2})}.
	\]
	Moreover, using the unary predicates \(\unarypred{b}\), \(b \in B\),
	we get that $\widehat f(\•A(s)) = \projHom{1}$ and $\widehat f(\•A(s)) = \projHom{2}$.

	We then define \[\+X \defeq \{g \in \powstruct{\?B}{(\iterstruct{\?B}{2})} \mid \text{ $g$ and $\projHom{1}$ are "linked" or $g = \projHom{1}$}\}.\]
	We claim that ${\widehat f}^{-1}[\+X]$ witnesses the fact that
	$\•G(s)$ and $\•G(t)$ are "regularly unconnected".
	First, $\projHom{1} \in \+X$ so $\•A(s) \in {\widehat f}^{-1}[\+X]$.
	Since $\?B$ has "finite duality", by \Cref{prop:characterization-finite-duality-path-projections}, $\projHom{2} \not\in \+X$
	and so $\•A(t) \not\in {\widehat f}^{-1}[\+X]$.
	Then, ${\widehat f}^{-1}[\+X]$ is "regular@@lang" since $\widehat f$ is a "regular homomorphism". Finally, ${\widehat f}^{-1}[\+X]$ is a union of
	equivalences classes of $\domainPres{\•A}$ under ``being "linked"''.\footnote{Indeed,
	if $c_1, c_2 \in \?C$ are "linked" in some "structure" $\?C$ and if $f\colon \?C to \?D$ is a "homomorphism", then $f(c_1)$ and $f(c_2)$ are "linked" in $\?D$.}
	Hence, by \Cref{claim:reduction-homreg-from-graph-to-link}, $\•G(s)$ and $\•G(t)$ are "regularly unconnected".

	\begin{claim}
		\AP\label{claim:reduction-homreg-converse}
		If $\•G(s)$ and $\•G(t)$ are "regularly unconnected" in $\?G$,
		then $\•A\prodpres \iterstruct{\?B}{2} \homregto \marked{\?B}$.
	\end{claim}

	Since $\•G(s)$ and $\•G(t)$ are "regularly unconnected" in $\?G$,
	by \Cref{claim:reduction-homreg-from-graph-to-link} there is a "regular language" $L \subseteq \Sigma^*$ "st" $\•A(s)\in L$ and $\•A(t) \not\in L$,
	and $L$ is a union of equivalences classes of $\domainPres{\•A}$
	under ``being "linked"''.
	We define a function $f\colon \domainPres{\•A}\times B^2 \to B$ by 
	\[
		f(a, b, b') \defeq \begin{cases*}
			\;b & \text{ if $\•A(s) \in L$,} \\
			\;b' & \text{ otherwise,}
		\end{cases*}
	\]
	and we claim that $f$ is a "regular homomorphism" from
	\(\•A\prodpres \iterstruct{\?B}{2}\) to \(\marked{\?B}\).
	The proof that it is a "homomorphism" is similar to \Cref{claim:reduction-hom-converse}:
	in particular, we use the fact that $\•G(s)$ and $\•G(t)$ are not "connected" in $\?G$,
	which is a consequence of the fact that they are "regularly unconnected".
	"Regularity@@hom" follows from the "regularity@@lang" of $L$. 
	Hence, $\•A\prodpres \iterstruct{\?B}{2} \homregto \marked{\?B}$.

	Putting \Cref{claim:reduction-homreg-direct,claim:reduction-homreg-converse} together,
	we get that the reduction is correct.
	Lastly, note that is works in TODO:complexity because TODO.
\end{proof}

We then prove a lower bound on the complexity of "Regular Unreachability of Turing Machine Configurations".

\begin{lemma}
	\label{}
  	"Regular Unreachability of Turing Machine Configurations" is
	"RE"-hard.
\end{lemma}

\begin{proof}[Proof sketch]
  \proofcase{An undecidable problem on Turing machines.}
  We claim first that the following promise problem is undecidable.
  \decisionproblem{""Restricted Membership for Deterministic Reversible Turing Machines""}{
    A "deterministic" "reversible Turing machine" $\+M$, a state $q_0$,
    words $u_\top,u_\bot \in \Sigma^*$
    "st"
    \begin{enumerate}
      \item $u_\bot \not\in \semTM{\+M}$,
      \item neither $q_0\cdot u_\top$ nor $q_0\cdot u_\bot$ have a predecessor in the "configuration graph" of $\+M$, and
      \item all "configurations" except those "connected" to $q_0\cdot u_\top$ or $q_0\cdot u_\bot$ belong to the same "connected component" of the "configuration graph" of $\+M$.
    \end{enumerate}
  }{
    Does $u_\top \in \semTM{\+M}$?
  }

  \proofcase{Reduction to "Regular Unreachability of Turing Machine Configurations".}
  We reduce the complement of this problem to "Regular Unreachability of Turing Machine Configurations". More precisely, we map an instance
  $\langle \+M,\, q_0,\, u_\bot,\, u_\top \rangle$ to $\langle \+M',\, q_0\cdot u_\top,\, q_0\cdot u_\bot \rangle$ where $\+M'$ does the same thing as $\+M$ except that it adds `$cd$' at the end of the tape
  whenever it takes a transition of $\+M'$, where $c$ and $d$ are new letters.
  We also add all necessary transitions in order to have the following property:
  the connected components of $\+M'$ are (essentially):
  \begin{itemize}
    \item $\gamma_0 \to \gamma_1\cdot cd \to \gamma_2\cdot c^2d^2 \to \cdots$
    where $\gamma_0 \to \gamma_1 \to \gamma_2 \to \cdots$ is the reachable configurations from $q_0\cdot u_\top$ in $\+M$,
    \item same for $q_0\cdot u_\bot$,
    \item all other configurations.
  \end{itemize}
  If $u_\bot \in \semTM{\+M}$ then the first component is finite and hence regular, and it clearly separated $q_0\cdot u_\top, q_0\cdot u_\bot$.
  If $u_\bot \not\in \semTM{\+M}$, then the possible separators are $\textrm{Reach}(q_0\cdot u_\top)$
  and $\complement\,\textrm{Reach}(q_0\cdot u_\bot)$, but neither of them is regular because of the
  $c^nd^n$ business. 
\end{proof}

\begin{corollary}
	\AP\label{coro:lowerbound-homreg}
	If $\?B$ does not have "finite duality", then $\HomAut{\?B}$
	is "RE"-hard.
\end{corollary}

\begin{proof}
	TODO.
\end{proof}