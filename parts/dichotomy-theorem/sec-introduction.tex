\section{Introduction}
\AP\label{sec:dichotomy-introduction}


\subsection{Classes of Relations}

Classes of relations on words\footnote{In this context, ``relations on words''
are often called ``transductions''.} have always been a central topic in language theory
\cite{ElgotMezi1965RelationsGeneralizedAutomata,Nivat1968TransductionChomsky,Berstel1979Transductions,FrougnySakarovitch1993SynchronizedRationalRelations,Choffrut2006Survey}. 
More recently, their study has been motivated by database theory and verification,
where they are used to build expressive languages. For instance, classes of relations of this kind are relevant for querying strings over relational 
databases \cite{BenediktLibkinSchwentickSegoufin2003DefinableRelations}, comparing paths in graph databases \cite{BarceloLibkinLinWood2012ExpressiveLanguages}, or defining  
string constraints for model checking \cite{LinBarcelo2016StringSolvingWordEquationsTransducers}. 
The most studied such classes include "recognizable@@rel", "automatic@@rel" "aka" "synchronous@@rel", and "rational relations", each one of the latter two strictly extending the previous one. 

% \AP ""Rational relations"" are those definable by multi-head automata, with heads possibly moving asynchronously; "automatic relations" are "rational relations" that are accepted by multi-head automata whose heads are forced to move synchronously; and 
% "recognizable relations" correspond to finite unions of products of regular languages (or, equivalently, to languages recognized via finite monoids, by Mezei's Theorem). By definition, all of these classes coincide with the 
% class of regular languages when restricted to unary relations.

Prior work has focused on the ""$\REC$-definability problem"", 
which takes as input an $n$-ary "rational relation"%
\footnote{
	Recall that "rational relations" are those definable by multi-head automata,
	with heads possibly moving asynchronously;
	"synchronous relations" are "rational relations" that are accepted by multi-head automata
	whose heads are forced to move synchronously; and 
	"recognizable relations" correspond to finite unions of products of regular languages---or, equivalently, to languages recognized via finite monoids, by Mezei theorem.
	By definition, all of these classes coincide with the 
	class of "regular languages" when restricted to unary relations.
}
$\+R$ and asks whether it is equivalent to a "recognizable relation"
$\bigcup_i L_{i,1} \times \cdots \times L_{i,n}$, where each $L_{i,j}$ is a "regular language". 
Intuitively, the problem asks whether the different components of  
the "rational relation" $\+R$ are almost independent of one another.
The study of "$\REC$-definability"
is relevant since relations enjoying this property are often amenable to some analysis including,
"eg", abstract interpretations in program verification, variable elimination in constraint logic 
programming, and query processing over constraint databases---see \cite[Introduction]{BarceloHongLeLinNiskanen2019MonadicDecomposability} for a more thorough discussion on this topic.

In general, "$\REC$-definability" of "rational relations" is undecidable, but it becomes decidable 
for two important subclasses: 
deterministic "rational relations" and "synchronous relations". 
For deterministic "rational relations",  "$\REC$-definability" has been shown to be decidable in 
double-exponential time for binary relations
by Valiant \cite{Valiant1975RegularityDeterministicPushdown}---improving Stearns's
triple-exponential bound \cite{Stearns1967RegularityPushdown}.
The decidability result was later extended to relations of arbitrary arity by Carton, Choffrut and 
Grigorieff \cite[Theorem 3.7]{CartonChoffrutGrigorieff2006DecisionProblems}.
For "synchronous relations", the decidability of "$\REC$-definability"
can be obtained by a  simple reduction to the problem of checking whether a finite automaton 
recognizes an infinite language \cite{LodingSpinrath2019DecisionProblems}---which is decidable via 
a standard reachability argument. 
The precise complexity of the problem, however, was only recently pinned down.
By applying techniques based on Ramsey Theorem over infinite graphs, it was shown that 
"$\REC$-definability" of "synchronous relations" is 
"PSpace"-complete when relations are specified by non-deterministic automata
\cite[Theorem 1]{BarceloHongLeLinNiskanen2019MonadicDecomposability} \cite[Corollary 2.9]{BergstrasserGanardiLinZetzsche2022RamseyQuantifiers}.

\AP On the other hand, much less is known about the ""$\RAT$/$\REC$-separability problem"", which takes two $n$-ary "rational relations" 
$\+R,\+R' \subseteq \Sigma^* \times \Sigma^*$ and checks whether there is a "recognizable relation" 
$S = \bigcup_i L_{i,1} \times \cdots \times L_{i,n}$
with $\+R \subseteq \+S$ and $\+R' \cap \+S = \emptyset$. In other words, this problem asks whether we can \emph{over approximate} $\+R$ with a recognizable 
relation $\+S$ that is constrained not to intersect with $\+R'$. Separability problems of this kind abound in theoretical computer science, in particular
in formal language theory where they have gained a lot of attention over the last few years---see "eg" \cite{PlaceZeitoun2016SeparatingRegularLanguages,Kopczynski2016InvisiblePushdownLanguages,CzerwinskiMartensRooijenZeitounZetzsche2017DecidableSeparabilityPiecewiseTestable,ClementeCzerwinskiLasotaPaperman2017RegularSeparabilityParikhAutomata}. 

As for definability, the "$\RAT$/$\REC$-separability problem"
is in general undecidable, so in this chapter we focus on its restriction to
"synchronous relations".
\decisionproblem{
	"$\SYNC$/$\REC$-separability problem".
}{
	Two "synchronous relations" $\+R$ and $\+R'$.
}{
	Does there exist a "recognizable relation" $\+S$ "st" $\+R \subseteq \+S$
	and $\+R' \cap \+S = \emptyset$?
}
Notice that when $\+R'$ is the complement of $\+R$ this problem boils down to "$\REC$-definability" on "synchronous relations"---which is decidable. 
However, "$\SYNC$/$\REC$-separability" is more general than this problem,
and to this day it is unknown whether it is decidable. 


\subsection{Constraint Satisfaction Problems}

Our work on the "$\SYNC$/$\REC$-separability problem" will eventually lead up to
the study of "homomorphisms problem" where the "target structure" is fixed.
These problems are the central topic of "constraint satisfaction problems" ("CSPs").%
\footnote{A typical example of such a problem is to work on the "graph signature", and to fix the
target structure to be the "$k$-clique" ($k \in \Np$): it exactly corresponds to
the "$k$-colourability problem".}
When the target structure is finite, the "homomorphisms problem" is known to be decidable
in "NP". The precise complexity of the problem, however, depends on the "structure" of the target,
and is tightly connected to the algebraic properties of the algebra associated to the
"structure".

A central conjecture of the domain, stated by Feder and Vardi,
known as the ``dichotomy conjecture'', stated that any "CSP"---whose "target structure" is 
finite---is either in "P" or "NP"-complete,\footnote{In other words, there is no "NP"-intermediate 
problem amongst these problems.} and the characterization of "structures" for which the problem
was tractable is precisely formulated in algebraic terms.%
\footnote{Tractable structures are those whose algebra admit a
``weak near-unanimity operation'', see "eg" \cite[\S~1, p.~3]{Zhuk2020CSPDichotomy}.}
Twenty-four years later, this conjecture was proven independently by
Bulatov \cite[Theorem 1]{Bulatov2017DichotomyCSPs}
and Zhuk \cite[Theorem 1.4]{Zhuk2020CSPDichotomy}.
This algebraic approach is particularly fruitful but lies beyond
the scope of this thesis: we refer the reader to \cite{BartoKrokhinWillard2017Polymorphisms,Larose2017DigraphCSP} for surveys on the topic.

\begin{marginfigure}
	\centering
	\begin{tikzpicture}
		\input{tikz/dichotomy/2-transitive-tournament}
	\end{tikzpicture}
	\caption{
		\AP\label{fig:T2}
		The "$2$-transitive tournament" $\transitiveTournament{2}$.
	}
\end{marginfigure}
\begin{marginfigure}
	\centering
	\begin{tikzpicture}
		\input{tikz/dichotomy/2-path-graph}
	\end{tikzpicture}
	\caption{
		\AP\label{fig:P2}
		The "$2$-path" $\pathGraph{2}$.
	}
\end{marginfigure}
Beyond "P" and "NP", the complexity of the "homomorphism" problem can reach some
surprisingly low complexities.
For instance, given $k\in\N$, we define the \AP""$k$-transitive tournament"", denoted
by \AP$\intro*\transitiveTournament{k}$ and illustrated on \Cref{fig:T2},
to be the "directed graph" with vertices $0$, $1$, $\hdots$, $k$,
and with an edge from $i$ to $j$ "iff" $i < j$.
Similarly, the \AP""$k$-path"" \AP$\intro*\pathGraph{k}$ has $\lBrack 0,k\rBrack$ as
its set of vertices, with an edge from $i$ to $j$ "iff" $j = i + 1$---see \Cref{fig:P2}.

Then, a "graph" $\?G$ admits a "homomorphism" to $\transitiveTournament{k}$ "iff"
it has no directed path of size $k+1$, in the sense that this is no "homomorphism"
from $\pathGraph{k+1}$ to $\?G$. Symbolically:
\[
	\forall \?G,\quad
	\pathGraph{k+1} \nothomto \?G
	\quad\text{"iff"}\quad
	\?G \homto \transitiveTournament{k}.
\]
As a result, to decide if, for a "finite graph" $\?G$, we have
$\?G \homto \transitiveTournament{k}$, it suffices
to test if $\pathGraph{k+1} \nothomto \?G$, which can be done in "FOfin"!

Structures sharing the same property as $\transitiveTournament{k}$, meaning that
the existence of a "homomorphism" to them amounts to not containing any "obstructions"
among a fixed finite set of "obstructions" are said to have "finite duality".
Like $\transitiveTournament{k}$, their "constraint satisfaction problem"
is in "FOfin".\footnote{Recall that "FOfin" $\subseteq$ "L", see \Cref{prop:FO-in-L}.}
Atserias proved the converse implication to this result.
todo:addref.

\AP\begin{proposition}[""Atserias' theorem"", {\cite[Corollary 4]{Atserias2008DigraphColoring}}]
	Let $\?B$ be a "finite $\sigma$-structure". Then $\?B$ has "finite duality"
	if, and only if, $\HomAllClass{\?B}$ is "first-order definable".
\end{proposition}

This chapter will generalize some results on the "homomorphism problem"
from "finite structures" to "automatic structures". The study of "CSPs" beyond finite set
is far from a new topic, and has been the subject of many works in the past decade:
see for instance \cite{KlinKopczynskiOchremiakTorunczyk2015LocallyFiniteCSP} for "CSPs"
over ``nominal structures'', "ie" "structures" with ``atoms'',
or \cite{KlinLasotaOchremiakTorunczyk2016HomomorphismProblems} for "CSPs" over
"$\sigma$-structures" which are "first-order definable" over $\tup{\N,{=}}$.


\subsection{Contributions}



\subsection*{Old}

\begin{restatable*}{theorem}{DichotomyThmDichotomyAutomatic}[Dichotomy Theorem for Automatic Structures]
	\!\footnote{The equivalence between (1) and (2) still holds
	when the "homomorphism problem" takes as input ``higher-order automatic
	structures'' as defined in \cite[last remark of \S~XII.3]{Blumensath2024MSOModelTheory},
	since such structures have a decidable first-order theory.}%
	%%%
	\AP\label{thm:dichotomy-theorem-automatic-structures}
	Let $\?B$ be an arbitrary "$\sigma$-structure". The following are equivalent:
	\begin{description}
		\itemAP[\intro*\itemDTFinDual.] $\?B$ has "finite duality";
		\itemAP[\intro*\itemDTHomDec.] $\HomAutDec{\?B}$ is decidable;
		\itemAP[\intro*\itemDTHomRegDec.] $\HomRegAutDec{\?B}$ is decidable;
		\itemAP[\intro*\itemDTEqual.] $\HomAutDec{\?B} = \HomRegAutDec{\?B}$ "ie" for any "rational presentation" $\•A$ of a 
		"$\sigma$-structure" $\?A$, there is a "homomorphism" from $\?A$ to $\?B$ "iff" 
		there is a "regular homomorphism" from $\•A$ to $\?B$;
		\itemAP[\intro*\itemDTFirstOrder.] $\HomAllClass{\?B}$ has "uniformly first-order definable homomorphisms".
	\end{description}
	Moreover, when $\HomAutDec{\?B}$ and $\HomRegAutDec{\?B}$ undecidable, they are "coRE"-complete
	and "RE"-complete, respectively. When they are decidable, they are "NL".
\end{restatable*}
	  
TODO: say that to have "finite duality" can be decided.