\chapter{Conclusion \fancyand~Open Problems}
\label{ch:conclu-automatic}

\section{Separating Automatic Relations by Recognizable Ones}

The problem introduced in \Cref{ch:preliminaries-automatic-structures}
remains open.

\openProblemAutRecSeparability*

In \Cref{ch:dichotomy-theorem}, we proved this problem to be equivalent
to "finite regular colourability of automatic graphs" (\Cref{thm:reg-colourability-equiv-separability}),
and showed that when the number of colours is fixed, the problem is undecidable
(\Cref{thm:k-reg-col-undec}).
In fact, we showed that most problems of this form are undecidable
(\Cref{thm:dichotomy-theorem-automatic-structures}).
However, as explained in \Cref{sec:dichotomy-discussion}, some gaps remain to be able to use
our techniques to prove the undecidability of the "$\AUT$/$\REC$-separability problem".

On the other hand, we introduced in \Cref{ch:algebra} an algebraic approach for
"automatic relations", hoping to prove the decidability of this problem.
\todo{self-citation!}
Unfortunately, alas, using this theory to tackle \Cref{opb:AUT-REC-separability}
seems non-trivial. The main obstacle being that, while
"recognizable relations" have some desirable closure properties,
they do not form a "pseudovariety of automatic relations"
\todo{addref-discuss-algebra}.%
\footnote{Explain why we couldn't know this \emph{a priori}.}

Overall, \Cref{opb:AUT-REC-separability} remains open.
Should this problem be decidable, the question of
the decidability of its generalization to larger class of relations would be
a natural next step.

\begin{openproblem}
	Are the "$\DRAT$/$\REC$-separability@@pb" and
	"$\RAT$/$\REC$-separability problems" decidable?
\end{openproblem}

In \cite[\S~1]{BarceloFigueiraMorvan2023SeparatingAutomatic},
we incorrectly stated that ``As for definability\footnote{Definability is the same
as the "membership problem".}, the "$\REC$-separability problem" for "rational relations" is in general undecidable'', which is false---or at least we do not know it to be true.

Indeed, as mentioned in \Cref{ch:preliminaries-automatic-structures},
the "$\RAT$/$\REC$-membership problem" is undecidable, by
\cite[\S~III, Theorem~8.4]{Berstel1979Transductions}.
Moreover, in general, "membership problems" reduced to "separability problems":
a relation $\+R$ belongs to a class $\+V$ if, and only if, $\+R$ and $\negrel \+R$
are "$\+V$-separable@@rel". However, for this argument to work, the larger class of relation
needs to be effectively closed under complement.
This is not the case of "rational relations", see \Cref{sec:prelim-rational-relations}.

For "deterministic rational relations", while they are effectively
closed under complementation, the "$\DRAT$/$\REC$-membership problem"
is decidable---see \Cref{sec:dichotomy-introduction-relations}!

\section{Colouring Problems on Automatic Graphs}

Let us quickly recall some of the conjectures that have been discussed in \Cref{sec:dichotomy-discussion}.
The first one is about finding an equivalent characterization in the "dichotomy theorem
for automatic structures" (\Cref{thm:dichotomy-theorem-automatic-structures}).

\conjInvarianceGraphIsomorphisms*

In other words, this problem could be rephrased as follows: ``is a problem
of the form $\HomRegAut{\?B}$ decidable if, and only if, its output
only depends on the "structure represented" by the "automatic presentation",
and not on the "presentation@@auto" itself?''

Going back to out original question,
while we do not know if "finite regular colourability of automatic graphs"
is decidable, it is natural to study variations of this problem, as well as
sufficient or necessary conditions to ensure colourability or non-colourability.
Unfortunately, these problems are also non-trivial.

\conjFiniteColourabilityUndecidable*

\conjUnboundedCliques*

\section{An Algebraic Approach Beyond Automatic Relations}

The algebraic theory developed in \Cref{ch:algebra} can be generalized,
by replacing the constraint of ``being "well-formed"'' with an arbitrary
"regular language" $\Omega$. This would result in the notion
of \AP""$\Omega$-path algebras""---with "$\WellFormed$-path algebras" corresponding
to our "synchronous algebras".

While there is no hope to get a version of the
"lifting theorem" (\Cref{thm:lifting-theorem-monoids}) for every $\Omega$---see \todo{addref-rk-conclu-algebra}, I believe it could hold for some languages $\Omega$,
namely those that are "fully-preordered@@lang",
in the sense that there exists a preorder $\preccurlyeq$ on the alphabet $\Sigma$
"st" $\Omega = \{u_1 \dotsc u_n \in \Sigma^* \mid u_1 \preccurlyeq \dotsc \preccurlyeq u_n\}$.
See \todo{addref-conclu-algebra} for more details.

Interestingly, we believe this question to be related to Figueira \& Libkin's
"$T$-controlled relations", presented in
\Cref{sec:preliminaries-automatic-structures-relations-restricted-head-movements}.
We believe that each language $T$, specifying the head movements that are allowed,
gives rise to a language $\Omega_T$, such that relations recognized
by finite "$\Omega_T$-path algebras" exactly correspond to 
the "$T$-controlled relations".
\opbControlledRelations
We think that, one way of tackling this problem would be study properties of
the category of "$\Omega_T$-path algebras".

\begin{conjecture}
	\label{conj:controlled-relations-category-equivalence}
	There is a way of defining $T \mapsto \Omega_T$ "st"
	"$T_1$-controlled relations" exactly correspond to "$T_2$-controlled relations"
	if, and only if, the category of "$\Omega_{T_1}$-path algebras"
	is equivalent to the category of "$\Omega_{T_2}$-path algebras".
\end{conjecture}

Hopefully, the latter condition could maybe be massaged to get decidability.


\section{Theorem Projection via Monad Adjunction}

In fact, the conjecture of \Cref{conj:controlled-relations-category-equivalence}
is part of a larger idea we have.
In algebraic language theory, monads play an essential role---see \Cref{apdx:monads}.
Informally, a monad describes a universe.
For instance, the monad
\[
	\Sigma \mapsto \Sigma^*
\]
describes the universe of finite words, and gives rise to the notion of
"monoids". Similarly, weighted words over a field $\mathbb{K}$ can be described by
\[
	\Sigma \mapsto \mathbb{K}\Sigma^*,
\]
where $\mathbb{K}X$ denotes the free vector space over set $X$.
Again, this monad gives rise to Reutenauer's ``algèbres associatives''
\cite{Reutenauer1980SeriesFormelles}, "aka" ``$\mathbb{K}$-weighted monoids'',
which is essentially an algebraic structure that is both a monoid and a
$\mathbb{K}$-vector space.
Our "synchronous algebras" are no exception---see \Cref{apdx:monads}---,
and we refer the reader to \cite[\S~4]{Bojanczyk2020MSO} for more examples.

For well-behaved monads, ``languages'' recognized by their finite algebras
coincide with "monadic second-order"-definable languages.%
\footnote{We refer here to \emph{external} logics in the sense of
\Cref{rk:internal-vs-external-logic}.}
This gives rise to a natural set of questions, consisting
in finding algebraic characterizations
of fragments of "monadic second-order logic".
The perhaps most celebrated example is that of
the Schützenberger-McNaughton-Papert theorem
proves that "first-order"-definable languages of finite words
are exactly those recognized by aperiodic monoids \todo{addref}.
The statement was extended to $\omega$-words by \todo{},
to countable ordinal words by \todo{}, and to countable scatter words by
\todo{}.
In the latter case, asking only for aperiodicity is not enough:
the algebra should also be ``gap-insensitive''.%
\footnote{In the more general case of words over countable orderings,
Colcombet and Sreejith also provides a characterization for "first-order"
definable languages, although it is more complex \todo{addref}.}
This can be explained as follows: by going from the simpler setting
of finite words (or countable ordinal words) to countable scattered words,
there are new phenomena that appear and that "first-order logic" is 
not able to describe.

However, intuitively, going in the other direction should be easy!
Given an algebraic characterization of first-order logic over a ``richer'' monad
("eg" countable scatter words), it should be easy to reprove the
Schützenberger-McNaughton-Papert theorem over finite words, using the
``rich'' algebraic characterization as a black box.

Surprisingly, while it is easy to ``project'' the algebraic characterization
of first-order logic over $\omega$-words to get its counterpart for finite words,
the task becomes less straightforward---but still possible---when projecting from
countable ordinal words or countable scattered words to finite ones.
In both cases, the proof relies on two ingredients:
\begin{itemize}
	\item a function, encoding a language of finite words into
		a language in the richer setting;
	\item a function, projecting a language in the richer setting
		to a language of finite words.
\end{itemize}
Moreover, both functions should preserve the properties that we are studying---either
being "first-order" definable, or satisfying the algebraic characterization.
\todo{figure}

In the case of $\omega$-words, finding these functions is easy: for instance, 
the projection simply consists in restricting a language of words of
length at most $\omega$ to the finite words.
On the other hand, the projection from countable scattered words
to finite ones cannot simply do this, since finite words are not
"first-order" definable amongst countable scattered ones.
Hence, the projection in question needs to be tailor-made to 
preserve first-order logic.\footnote{This construction is an unpublished joint
work with Thomas Colcombet.}

In fact, the projection of $\omega$-words to finite words does not only preserve
the property of being "first-order" definable, but more generally any
"pseudovariety@@reglang"! In this sense, words of length at most $\omega$
form a \emph{conservative extension} of finite words, while
countable scattered words do not: this is why we can find a single construction
to project algebraic characterizations%
\footnote{By ``algebraic characterization'' we formally mean an "Eilenberg correspondence".}
from $\omega$-words to finite ones, but not from countable scattered words to finite ones.

This begs the question: how can we formalize this idea of a monad being
a \emph{conservative extension} of another one?
In light of \todo{addref-fig} propose to look at the notion of "monad adjunction".
Before introducing it, we need a preliminary definition.

Let $\Monad[S] = (S,\unit,\mult)$ be a "$\cat{C}$-monad"
and $\Monad[T] = (T,\unit,\mult)$ be a "$\cat{D}$-monad".%
\footnote{Following Street, we use the same notation for the unit and multiplication in $\Monad[S]$ and $\Monad[T]$.}
We assume $\cat C$ and $\cat D$ to be both categories of typed sets.
A \AP""monad functor"",%
\footnote{The notion was introduced by Street \cite[\S 1]{Street1972Monads}
in the slightly more general context of 2-categories.
We found this reference thanks to \cite{Rezk2012Functors}. "Monad functors" are also known as
``lax maps of monads''.}
from $\Monad[S]$ to $\Monad[T]$ is a pair $(\Phi, F)$, where:
\begin{itemize}
\item $F\colon \cat{C} \to \cat{D}$ is a functor,
\item $\Phi\colon TF \Rightarrow FS$ is a natural transformation,
\end{itemize}
such that, for every object $X \in \cat{C}$, the following diagrams commute:
\begin{center}
	\intro*\MFunit\textup{:}
	\begin{tikzcd}
		FX \ar[d,"\unit_{FX}" swap] \ar[dr, "F\unit_{X}"] & \\
		TFX \ar[r,"\phi_{X}" swap] & FSX.\\
	\end{tikzcd}\\
\; and \;
	\intro*\MFmult\textup{:}
	\begin{tikzcd}[row sep=small, column sep=1em]
		& & TFSX \ar[rr, "\phi_{SX}"] & &  FSSX \ar[drr, "F\mult_X", bend left=0] \\
		TTFX \ar[urr, "T\phi_X", bend left=0] \ar[drrr, "\mult_{FX}" swap, bend right=0] & &
			& & & & FSX. \\
		& & & TFX \ar[urrr, "\phi_X" swap, bend right=0]
	\end{tikzcd}
\end{center}
Such a pair is denoted by $\intro*\MF{\Phi}{F}\colon \Monad[S] \Rightarrow \Monad[T]$.

\todo{examples}

\begin{definition}
	
\end{definition}


\todo{explain-more}
\todo{$T$ and $\Omega$ play the same role.}