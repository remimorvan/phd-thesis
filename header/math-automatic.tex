% ---
% Constructions on structures / presentations 
% --- 
\knowledgenewrobustcmd\prodpres{\mathbin{\cmdkl{\underline{\times}}}}

\renewrobustcmd{\ker}[1]{\withkl{\kl[\ker]}{\mathrel{\cmdkl{\mathrm{ker}_{#1}}}}} % ker of hom
	\knowledge{\ker}{notion}

% ---
% Idempotent core
% --- 
\knowledgenewrobustcmd\marked[1]{#1^{\cmdkl{\dag}}}
\knowledgenewrobustcmd\unarypred[1]{\cmdkl{P_{#1}}}
\knowledgenewrobustcmd\extendedSignature[2]{\cmdkl{#1_{#2}}}

% ---
% Hom-reg relation 
% ---
\knowledgenewrobustcmd{\homregto}{\mathrel{\cmdkl{\smashxrightarrow{reg hom}}}}
\newrobustcmd{\nothomregto}{\mathrel{\kl[\homregto]{\centernot{\smashxrightarrow{reg hom}}}}}

% ---
% Interpretations & Automatic presentations
% ---
\knowledgenewrobustcmd{\interpretation}[2]{\cmdkl{#1(#2)}}
\knowledgenewrobustcmd{\domainInter}[1]{\cmdkl{\mathrm{dom}_{#1}}}
\knowledgenewrobustcmd{\relInter}[2]{\cmdkl{#1_{\! #2}}}
\knowledgenewrobustcmd{\domainPres}[1]{\cmdkl{\mathrm{dom}_{#1}}}
\knowledgenewrobustcmd{\relPres}[2]{\cmdkl{#1_{\! #2}}}
\newrobustcmd{\smallpad}{%
	\hspace{.05em}\rule{.3em}{.075em}\hspace{.05em}
}
% \newcommand\vartextvisiblespace[1][.5em]{%
% 	\kern.07em
% 	\vrule width.12ex height.5ex
% 	\vrule width#1 height.12ex
% 	\vrule width.12ex height.5ex
% 	\kern.07em
% }
% \knowledgenewrobustcmd{\pad}{%
% 	\cmdkl{\vartextvisiblespace}
% }
\knowledgenewrobustcmd{\pad}{\cmdkl{\smallpad}}
\knowledgenewrobustcmd{\convol}{\mathbin{\cmdkl{\otimes}}} % convolution of two words of languages
\newrobustcmd\pair[2]{{\smaller\left(\begin{smallmatrix}%
	#1\vphantom{b}\\%
	#2\vphantom{b}%
\end{smallmatrix}\right)}} % pair of letters
\newrobustcmd\triple[3]{{\smaller\left(\begin{smallmatrix}%
	#1\vphantom{b}\\%
	#2\vphantom{b}\\%
	#3\vphantom{b}%
\end{smallmatrix}\right)}} % truple of letters
\knowledgenewrobustcmd{\convolAlpha}{\mathbin{\cmdkl{\otimes}}}
\knowledgenewrobustcmd\SigmaPair[1][\Sigma]{\cmdkl{#1^{\smash{2}}_{{\otimes}}}}
\knowledgenewrobustcmd{\convolRel}[1]{#1^{\cmdkl{\otimes}}} % convolution of a relation
\knowledgenewrobustcmd\WellFormed[1][\Sigma]{\cmdkl{\textsf{WellFormed}_{#1}}} % well-formed words
\knowledgenewrobustcmd\projWord{\cmdkl{\pi_{\textsf{word}}}} % projection of multitape word
\knowledgenewrobustcmd\projTape{\cmdkl{\pi_{\textsf{tape}}}}

% ---
% Hom problem & classes 
% --- 
\knowledgenewrobustcmd\Fin[1][\sigma]{\cmdkl{\mathrm{Fin}_{#1}}}
\knowledgenewrobustcmd\Aut[1][\sigma]{\cmdkl{\mathrm{Aut}_{#1}}}
\knowledgenewrobustcmd\FinPres[1][\sigma]{\cmdkl{\mathcal{F\!in}^{\smash{\textsf{pres}}}_{#1}}}
\knowledgenewrobustcmd\AutPres[1][\sigma]{\cmdkl{\mathcal{Aut}^{\smash{\textsf{pres}}}_{#1}}}

\newrobustcmd{\classStruct}{\mathcal{Cls}}

\newrobustcmd{\HomNoKl}[2]{\mathcal{H\!om}(#1,\,#2)}
\knowledgenewrobustcmd\Hom[2]{\cmdkl{\HomNoKl{#1}{#2}}}
\knowledgenewrobustcmd\HomFin[1]{\cmdkl{\HomNoKl{\mathrm{Fin}}{#1}}}
\knowledgenewrobustcmd\HomAut[1]{\cmdkl{\HomNoKl{\mathrm{Aut}}{#1}}}
\knowledgenewrobustcmd\HomAll[1]{\cmdkl{\HomNoKl{\mathrm{All}}{#1}}}

\newrobustcmd{\HomRegNoKl}[2]{\mathcal{H\!om}^{\smash{\textsf{reg}}}(#1,\,#2)}
\knowledgenewrobustcmd\HomReg[2]{\cmdkl{\HomRegNoKl{#1}{#2}}}
% \knowledgenewrobustcmd\HomRegFin[1]{\cmdkl{\HomRegNoKl{\mathrm{Fin}}{#1}}}
\knowledgenewrobustcmd\HomRegAut[1]{\cmdkl{\HomRegNoKl{\mathrm{Aut}}{#1}}}

% ---
% Concrete graphs / structures 
% ---
\knowledgenewrobustcmd\link[1]{\cmdkl{\?L_{#1}}}
\knowledgenewrobustcmd{\zigzag}[2]{\cmdkl{\?Z_{#2}^{(#1)}}}
\knowledgenewrobustcmd{\transitiveTournament}[1]{\cmdkl{\?T_{#1}}}
\knowledgenewrobustcmd{\pathGraph}[1]{\cmdkl{\?P_{#1}}}
\knowledgenewrobustcmd{\clique}[1]{\cmdkl{\?K_{#1}}}
\newcommandPIE{\omegaClique}{\withkl{\kl[\omegaClique]}{\cmdkl{\?K_{<\omega}#1#2#3}}}
	\knowledge{\omegaClique}{notion}
\newcommandPIE{\omegaCliquePres}{\withkl{\kl[\omegaCliquePres]}{\cmdkl{\+K_{\!<\omega}#1#2#3}}}
	\knowledge{\omegaCliquePres}{notion}

\knowledgenewrobustcmd\projHom[1]{\cmdkl{\pi_{#1}}} % projection homomorphism
\knowledgenewrobustcmd{\FederVardi}[1]{\cmdkl{\symfrak{U}(#1)}} % Feder-Vardi's construction
\knowledgenewrobustcmd\Myc{\mathop{\cmdkl{\symfrak{M}}}} % Mycielski's construction
\knowledgenewrobustcmd\MycInf{\mathop{\cmdkl{\?M}}} % Infinite Mycielski graph

% ---
% First-order logic for automatic relations
% ---
\knowledgenewrobustcmd{\lastLetter}[1]{\cmdkl{\+l_{#1}}}
\knowledgenewrobustcmd{\univStructSynchronous}[1]{\cmdkl{\?{#1^*}}}
\knowledgenewrobustcmd{\signatureSynchronous}[1]{\cmdkl{\sigma_{#1}^{\smash{\textrm{sync}}}}}

% ---
% Hyperedge consistency
% ---
\knowledgenewrobustcmd{\subsumed}{\mathrel{\cmdkl{\sqsubseteq}}}
\knowledgenewrobustcmd{\LatticeGuessFunctions}[2]{\cmdkl{\langle \pset{#2}^{#1},\, \subsumed \rangle}}
\knowledgenewrobustcmd{\topLatticeGuessFunctions}[1]{\cmdkl{\Lambda_{#1}}}

\newcommandPIE{\HCOperator}{\withkl{\kl[\HCOperator]}{\cmdkl{\symcal{H\!C}#1#2#3}}}
	\knowledge{\HCOperator}{notion}
\knowledgenewrobustcmd{\HCFixpoint}[2]{\cmdkl{H^{\,*}_{\smash{#1,#2}}}}

% ---
% Misc. dichotomy theorem
% ---
\knowledgenewrobustcmd{\unaryType}[2]{\cmdkl{\mu_{#2}(#1)}}
\knowledgenewrobustcmd{\structOfUnaryType}[1]{\cmdkl{\?1_{#1}}}
\knowledgenewrobustcmd{\ConstrUndecHom}[1]{#1^{\cmdkl{\star}}}
\knowledgenewrobustcmd{\rightquotient}[2]{#1\mathbin{\cmdkl{/}}#2}
\knowledgenewrobustcmd{\restrConnected}[1]{\cmdkl{\restr{#1}{\textrm{conn}}}}

\knowledgenewrobustcmd{\itemDTFinDual}{\cmdkl{\text{\bfseries\textup{(\textsf{DT})$_\textsf{fin-dual}$}}}}
\knowledgenewrobustcmd{\itemDTHomDec}{\cmdkl{\text{\bfseries\textup{(\textsf{DT})$_\textsf{hom-dec}$}}}}
\knowledgenewrobustcmd{\itemDTHomRegDec}{\cmdkl{\text{\bfseries\textup{(\textsf{DT})$_\textsf{hom-reg-dec}$}}}}
\knowledgenewrobustcmd{\itemDTEqual}{\cmdkl{\text{\bfseries\textup{(\textsf{DT})$_\textsf{equal}$}}}}
\knowledgenewrobustcmd{\itemDTFirstOrder}{\cmdkl{\text{\bfseries\textup{(\textsf{DT})$_\textsf{first-order}$}}}}

% ---
% Classes of relations
% ---
\knowledgenewrobustcmd{\RAT}{\cmdkl{\ensuremath{\textsc{Rat}}}}%
\knowledgenewrobustcmd{\AUT}{\cmdkl{\ensuremath{\textsc{Aut}}}}%
\knowledgenewrobustcmd{\SYNC}{\cmdkl{\ensuremath{\textsc{Sync}}}}% todo:disable
\knowledgenewrobustcmd{\REC}{\cmdkl{\ensuremath{\textsc{Rec}}}}%
\knowledgenewrobustcmd\kREC[1][k]{\cmdkl{\ensuremath{#1\textsc{-Rec}}}}
\knowledgenewrobustcmd\kPROD[1][k]{\cmdkl{\ensuremath{#1\textsc{-Prod}}}}

% ---
% Example of relations
% ---
\knowledgenewrobustcmd\sameParity{\mathrel{\cmdkl{\approx_{\textrm{mod~2}}}}}
\knowledgenewrobustcmd{\equalLength}{\mathrel{\cmdkl{\approx_{\textrm{len}}}}}

\knowledgenewrobustcmd{\prefix}{\mathrel{\cmdkl{\preccurlyeq_{\textrm{pref}}}}}
\knowledgenewrobustcmd{\suffix}{\mathrel{\cmdkl{\preccurlyeq_{\textrm{suff}}}}}
\knowledgenewrobustcmd{\subword}{\mathrel{\cmdkl{\preccurlyeq_{\textrm{subw}}}}}
\knowledgenewrobustcmd{\lex}{\mathrel{\cmdkl{\preccurlyeq_{\textrm{lex}}}}}


% ---
% Separation to Colourability
% ---
\knowledgenewrobustcmd{\Germ}[1]{\cmdkl{\textrm{Germ}_{#1}}} % germinal configurations
\newrobustcmd{\GermC}[2]{\kl[\Germ]{\color{#2}\textrm{Germ}_{#1}}} % variant with color
\knowledgenewrobustcmd{\Reach}[1]{\cmdkl{\textrm{Reach}_{#1}}}
\newrobustcmd{\ReachC}[2]{\kl[\Reach]{\color{#2}\textrm{Reach}_{#1}}} % variant with color

\knowledgenewrobustcmd{\incompGraph}[2]{\cmdkl{\+{I\mkern-1.5mu nc}_{#1,#2}}} % incompatibility graph
\knowledgenewrobustcmd{\compL}{\cmdkl{\textnormal{\small(\textsc{comp}${}_\ell$)}}}
\knowledgenewrobustcmd{\compR}{\cmdkl{\textnormal{\small(\textsc{comp}${}_\textit{r}$)}}}
\knowledgenewrobustcmd{\compLpr}{\cmdkl{\textnormal{\small(\textsc{comp}${}'_\ell$)}}}
\knowledgenewrobustcmd{\compRpr}{\cmdkl{\textnormal{\small(\textsc{comp}${}'_\textit{r}$)}}}

\knowledgenewrobustcmd{\Id}{\cmdkl{\+{I\mkern-1.5mu d}}} % identity relation

\newrobustcmd{\bSymb}{\textcolor{cBlue}{b}}
\newrobustcmd{\rSymb}{\textcolor{cRed}{r}}

\knowledgenewrobustcmd{\configs}[1][\+T]{\cmdkl{\textrm{Conf}_{#1}}}
\knowledgenewrobustcmd{\confGraph}[1][\+T]{\cmdkl{{\+{C\mkern-1.5mu on\!f}}_{\!#1}}}

\knowledgenewrobustcmd{\autequiv}[1][\+R]{\cmdkl{\sim_{\!#1}}}


% =---=
% Algebras for Automatic Relations
% =---=

% ---
% Categories
% ---
\newrobustcmd\cat[1]{\mathsf{#1}}
\knowledgenewrobustcmd\Set[1][\+S]{\cmdkl{\cat{Set}^{\smash{#1}}}}
\knowledgenewrobustcmd\Pos[1][\+S]{\cmdkl{\cat{Pos}^{\smash{#1}}}}
\knowledgenewrobustcmd\Dep[1][\+S]{\cmdkl{\cat{Dep}^{\smash{#1}}}}

% ---
% Types
% ---
\usepackage{xfrac}
\knowledgenewrobustcmd\LL{\cmdkl{\text{\sfrac{\footnotesize\textsc{l}\,}{\,\footnotesize\textsc{l}}}}\hspace{.1em}}
\knowledgenewrobustcmd\LB{\cmdkl{\text{\sfrac{\footnotesize\textsc{l}\,}{\,\footnotesize\textsc{b}}}}\hspace{.1em}}
\knowledgenewrobustcmd\BL{\cmdkl{\text{\sfrac{\footnotesize\textsc{b}\,}{\,\footnotesize\textsc{l}}}}\hspace{.1em}}

% ---
% Types & co
% ---
\knowledgenewrobustcmd\proj[1]{\cmdkl{\underline{#1}}} % Projection of relation
\knowledgenewrobustcmd\projP[1]{\cmdkl{\underline{#1}}}

\knowledgenewrobustcmd\typeW[2]{#1_{\cmdkl{#2}}}
\knowledgenewrobustcmd\types{\cmdkl{\mathcal{T}}\!}
\knowledgenewrobustcmd\typesEps{\cmdkl{\mathcal{T}_{1}}\!}
\knowledgenewrobustcmd\concattype{\cmdkl{\cdot}}
\knowledgenewrobustcmd\type[3][]{#2^{#1}_{\cmdkl{#3}}}

\knowledgenewrobustcmd\disunion{%
	\mathop{\cmdkl{\text{\raisebox{-2pt}{\LARGE$\uplus$}}}}%
}

\knowledgenewrobustcmd\dep[1][]{%
	\mathrel{\cmdkl{\asymp#1}}%
}

\knowledgenewrobustcmd\negrel{\cmdkl{\neg}}

% ---
% Free & Syntactic algebras
% ---
\knowledgenewrobustcmd\Sync[2][2]{\cmdkl{\?S_{#1}#2}}
\knowledgenewrobustcmd\SyncP[2][2]{\cmdkl{\?S^+_{#1}#2}}
\knowledgenewrobustcmd\consol[1]{\cmdkl{#1^{\smash{0}}}}

\knowledgenewrobustcmd\projtype{\cmdkl{\pi_{\smash{\textsf{type}}}}}
\knowledgenewrobustcmd\projval{\cmdkl{\pi_{\smash{\textsf{val}}}}}
\knowledgenewrobustcmd\typemap{\cmdkl{\mathrm{type}}}

\knowledgenewrobustcmd\inducedmor[1]{\cmdkl{\smash{\tilde{#1}}}}
\knowledgenewrobustcmd\inducedalg[1]{\cmdkl{\?A_{#1}}}
% Same but for semigroups
\knowledgenewrobustcmd\inducedmorSg[1]{\cmdkl{\smash{\tilde{#1}}}}
\knowledgenewrobustcmd\inducedalgSg[1]{\cmdkl{\?A_{#1}}}

\knowledgenewrobustcmd\SyntSA[1]{\cmdkl{\?A_{\smash{#1}}}}
\knowledgenewrobustcmd\SyntSAM[2][]{\cmdkl{\eta_{\smash{#2}}^{#1}\!}}
\knowledgenewrobustcmd\SyntSAP[1]{\cmdkl{\?A_{\smash{#1}}}}
\knowledgenewrobustcmd\SyntSAMP[2][]{\cmdkl{\eta_{\smash{#2}}^{#1}\!}}
\newrobustcmd\consolSyntSAP[1]{\kl[\SyntSAP]{\?A_{#1}^{\kl[\consol]{\,\smash{0}}}}}
\newrobustcmd\consolSyntSAMP[1]{\kl[\SyntSAMP]{\eta_{#1}^{\kl[\consol]{\,\smash{0}}}}}
\knowledgenewrobustcmd\sgpSyntSAMP[1]{\cmdkl{\eta_{#1}^{\smash{\textsf{sgp}}}}}

\knowledgenewrobustcmd\quotient[2]{\cmdkl{{#1}/{#2}}}
\knowledgenewrobustcmd\residual[2][]{#2^{\cmdkl{-1}}_{\kl[\type]{#1}}}

\newcommand{\asympbar}{\mathrel{\raisebox{-.1em}{\scalebox{.6}{\ensuremath{\setstackgap{S}{0pt}%
	\stackMath\mathrel{\stackon{\frown}{\stackon{\raisebox{.135em}{\rule{.6em}{.08em}}}{\smile}}}}}}}}

\knowledgenewrobustcmd\congr[1]{%
	\mathrel{\cmdkl{\asympbar_{#1}}}%
}
\newrobustcmd\notcongr[1]{%
	\mathrel{\kl[\congr]{\centernot{\asympbar_{#1}}}}
}

\knowledgenewrobustcmd\compos{%
	\mathbin{\cmdkl{\circ}}%
}

\newrobustcmd{\coslicesurj}{\!\!\text{\rotatebox[origin=c]{60}{$\relbar\!\joinrel\!\twoheadrightarrow$}}\!}
\newrobustcmd{\coslice}{\!/}

% ---
% Varieties
% ---
\knowledgenewrobustcmd\projL[1]{\cmdkl{#1^{\textrm{sync}}}}
\knowledgenewrobustcmd\projA[1]{\cmdkl{#1^{\textrm{sync}}}}

\knowledgenewrobustcmd\corrAR{%
	\mathop{\cmdkl{\to}}%
}
\knowledgenewrobustcmd\corrRA{%
	\mathop{\cmdkl{\to}}%
}
\knowledgenewrobustcmd\corr{%
	\mathop{\cmdkl{\leftrightarrow}}%
}

\knowledgenewrobustcmd\Nil{\cmdkl{\+{(\mkern-1mu c\mkern-1mu o\mkern-2mu )\mkern-1mu F\mkern-2mu i\mkern-1mu n}}}
\knowledgenewrobustcmd\NilS{\cmdkl{\B{N}\textrm{il}}}
\knowledgenewrobustcmd\LocTriv{\cmdkl{\+{L\mkern-1mu I}}}
\knowledgenewrobustcmd\LocTrivS{\cmdkl{\B{LI}}}

% -----
% Profinite words
% -----

\knowledgenewrobustcmd\idem{\cmdkl{\omega}}
\knowledgenewrobustcmd\dist{%
	\mathop{\cmdkl{\textbf{d}}}%
}
\knowledgenewrobustcmd\rist{%
	\mathop{\cmdkl{\textbf{r}}}%
}
\knowledgenewrobustcmd\typing{%
	\mathop{\cmdkl{\textbf{t}}}%
}

\knowledgenewrobustcmd\profSy[1]{\cmdkl{\smash{\widehat{#1}}}}
\knowledgenewrobustcmd\profSg[1]{\cmdkl{\smash{\widehat{#1}}}}

\knowledgenewrobustcmd\profeq{%
	\mathrel{\cmdkl{=}}%
}
\knowledgenewrobustcmd\profimp{%
	\mathrel{\cmdkl{\to}}%
}
\knowledgenewrobustcmd\profequiv{%
	\mathrel{\cmdkl{\leftrightarrow}}%
}
\knowledgenewrobustcmd\profdep{%
	\mathrel{\cmdkl{\asymp}}%
}

\knowledgenewrobustcmd\semprofdep[1]{\cmdkl{\lBrack} #1 \cmdkl{\rBrack}}

% Induced dependencies

\knowledgenewrobustcmd\substitWord[2][\typing]{\cmdkl{#2^{#1}}}
\knowledgenewrobustcmd\substitProf[2][\typing]{\cmdkl{#2^{#1}}}
\knowledgenewrobustcmd\inducedProfdep[1]{\cmdkl{#1^{\smash{\textsf{sync}}}}}

\knowledgenewrobustcmd\EqVar[1]{\cmdkl{\+E_{\smash{#1}}}}

% Free pro-V algebras
\knowledgenewrobustcmd\distvar[1][\B{V}]{%
	\mathop{\cmdkl{\textbf{d}}_{#1}}%
}
\knowledgenewrobustcmd\ristvar[1][\B{V}]{%
	\mathop{\cmdkl{\textbf{r}}_{#1}}%
}
\knowledgenewrobustcmd\simvar[1][\B{V}]{\mathrel{\cmdkl{\asympbar_{#1}}}}
\knowledgenewrobustcmd\freepro[2][\B{V}]{\cmdkl{\smash{\widehat{\mathbf{F}}}_{#1}#2}}
\knowledgenewrobustcmd\freeproproj[1][\B{V}]{\cmdkl{\pi_{#1}}}

\newrobustcmd\Pl[1][\B{V}]{%
	\mathop{%
		\withkl{\kl[\Pl]}{%
			\cmdkl{\mathcal{P\mkern-1mu l}_{\mkern-2mu #1}}
		}%
	}%
}
\knowledge{\Pl}{notion}

\newrobustcmd\Cl[2][\B{V}]{%
	\mathop{%
		\withkl{\kl[\Cl]}{%
			\cmdkl{\mathcal{C\mkern-1mu l}_{\mkern-2mu #1}^{\smash{#2}}}
		}%
	}%
}
\knowledge{\Cl}{notion}


% ---
% Monads 
% ---

\knowledgenewrobustcmd\MonadSync[1][2]{\cmdkl{\B{S}_{#1}}}
\knowledgenewrobustcmd\MonadSyncP[1][2]{\cmdkl{\B{S}^+_{#1}}}

\newrobustcmd\PictureTypedSet[5]{
	\begin{center}
		\begin{tikzpicture}
			\node[draw, circle] (ll) at (0, 0)  {$\LL$};
			\node[draw, circle] (lb) [above right= .7cm and 1.4cm of ll] {$\LB$};
			\node[draw, circle] (bl) [below right= .7cm and 1.4cm of ll] {$\BL$};
			
			\draw (ll) edge[->, loop left] node[left] {$#1$} (ll);
			\draw (ll) edge[->, dashed] node[midway, fill=white, opacity=.8] {$#2$} (lb);
			\draw (lb) edge[->, loop right] node[right] {$#3$} (lb);
			\draw (ll) edge[->, dashed] node[midway, fill=white, opacity=.8] {$#4$} (bl);
			\draw (bl) edge[->, loop right] node[right] {$#5$} (bl);
		\end{tikzpicture}
	\end{center}
}

\newrobustcmd{\sat}{\mathrel{\kl[\sat]{\vDash}}}